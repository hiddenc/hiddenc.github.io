/*!
 * # abin common.js
 */
$(document).ready(function(){if($(".dropdown").length){$(".dropdown").dropdown()}if($(".notify").length){$(".notify").popup({hoverable:true,position:"top right",offset:8})}if($(".popup_favorites").length){$(".popup_favorites").popup()}if($(".ui.checkbox").length){$(".ui.checkbox").checkbox()}$(".ui.modal.ca_edit_profile_modal").modal("attach events",".ca_edit_profile");$("#form-userProfile").form({fields:{nickname:{identifier:"nickname",rules:[{type:"empty",prompt:EP_lang.nickname_empty_error},{type:"maxLength[50]",prompt:EP_lang.nickname_maxLength_error}]}},inline:true,on:"blur",onSuccess:function(a){a.preventDefault();a.stopPropagation();$.ajax({url:$("#form-userProfile").attr("action"),data:$("#form-userProfile").serialize(),type:$("#form-userProfile").attr("method"),dataType:"json",beforeSend:function(){$("#btn_userProfile").addClass("loading")}}).done(function(c){if(c.status=="success"){$("span.username").text(c.nickname);layer.msg(c.message,{icon:6});var d=$("#current_lang").val();var b=$("#change_lang_id").val();if(d!=b){window.location.reload()}}else{layer.msg(c.message,{icon:5})}$(".ui.modal.ca_edit_profile_modal").modal("hide")}).fail(function(){layer.msg("Edit user Profile form ajax error",{icon:2})}).always(function(){$("#btn_userProfile").removeClass("loading")});return false}});$(".ui.modal.ca_change_password_modal").modal("attach events",".ca_change_password");$("#form-userPassword").form({fields:{old_password:{identifier:"old_password",rules:[{type:"empty",prompt:EP_lang.current_password_empty_error},{type:"minLength[6]",prompt:EP_lang.current_password_minLength_error}]},new_password:{identifier:"new_password",rules:[{type:"empty",prompt:EP_lang.new_password_empty_error},{type:"minLength[6]",prompt:EP_lang.new_password_minLength_error}]},confirm_password:{identifier:"confirm_password",rules:[{type:"empty",prompt:EP_lang.confirm_password_empty_error},{type:"minLength[6]",prompt:EP_lang.confirm_password_minLength_error},{type:"match[new_password]",prompt:EP_lang.confirm_password_match_error}]}},inline:true,on:"blur",onSuccess:function(a){a.preventDefault();a.stopPropagation();$.ajax({url:$("#form-userPassword").attr("action"),data:$("#form-userPassword").serialize(),type:$("#form-userPassword").attr("method"),dataType:"json",beforeSend:function(){$("#btn_userPassword").addClass("loading")}}).done(function(b){if(b.status=="success"){layer.msg(b.message,{icon:6});$(".ui.modal.ca_change_password_modal").modal("hide")}else{layer.msg(b.message,{icon:5})}}).fail(function(){layer.msg("Edit user Password form ajax error",{icon:2})}).always(function(){$("#btn_userPassword").removeClass("loading")});return false}});$(".ui.modal.ca_upgrade_to_premium_modal").modal("attach events",".ca_upgrade_to_premium");$("#autocomplete").autocomplete({serviceUrl:$("#search-bar").attr("data-search-url"),paramName:"q",appendTo:$("#search-results"),onSelect:function(a){console.log($.isEmptyObject(a));if(!$.isEmptyObject(a)&&a.data!=""){window.location.href=a.data}},onSearchStart:function(){$("#search-bar").addClass("loading")},onSearchComplete:function(){$("#search-bar").removeClass("loading")}});$("div.nav_responsive_button").click(function(){if($("div.nav_responsive_list").is(":hidden")){$("div.nav_responsive_list").slideDown();$("div.nav_responsive_button").html(EP_lang.mobile_menu+' <i class="icon-up-open"></i>')}else{$("div.nav_responsive_list").slideUp();$("div.nav_responsive_button").html(EP_lang.mobile_menu+' <i class="icon-down-open"></i>')}});$("#validity").change(function(){var a=$(this).find("option:selected").data("price");$("#amount").text(a)});$("#btn_payment").click(function(){$(this).addClass("loading");setTimeout(function(){$("#btn_payment").removeClass("loading").addClass("disabled").text("支付完成后請刷新本頁面")},4000)});$(".ca_payment_records").click(function(){var a=$(this).data("ajax-url");if(a){$.ajax({url:a,type:"GET",dataType:"html",beforeSend:function(){var b='<tr id="payment_records_loader_tr"><td colspan="5"><div class="ui segment"><div class="ui active dimmer"><div class="ui medium text loader">Loading</div></div></div></td></tr>';$("#payment_records_list").html(b);$(".ca_payment_records_modal").modal("show")}}).done(function(b){$("#payment_records_list").html(b);$(".ca_payment_records_modal").modal("refresh")}).fail(function(){console.log("error")}).always(function(){$("#payment_records_loader_tr").hide()})}})});$(function(){if($(".ca_header .ca_nav ul").is(":hidden")||$(".ca_header .ca_nav ul").length==0){return}var b,a,d,e=$(".ca_header .ca_nav ul");e.append("<li id='magic_line'></li>");var c=$("#magic_line");c.width($(".active").width()).css("left",$(".active a").position().left).data("origLeft",c.position().left).data("origWidth",c.width());$(".ca_header .ca_nav ul li a").hover(function(){b=$(this);a=b.position().left;d=b.parent().width();c.stop().animate({left:a,width:d})},function(){c.stop().animate({left:c.data("origLeft"),width:c.data("origWidth")})})});jQuery(document).ready(function(){jQuery(document.body).pixusNotifications({speed:300,animation:"fadeAndSlide",hideBoxes:false})});(function(){$.fn.pixusNotifications=function(a){var b={speed:200,animation:"fade",hideBoxes:false};var a=$.extend({},b,a);return this.each(function(){var c=$(this),d=c.find(".notification"),h=d.find("p"),j=h.find("strong"),i=$('<a class="close" href="#"></a>');$(document.body).find(".notification").each(function(m){var m=m+1;$(this).attr("id","notification_"+m)});d.filter(".closeable").append(i);closeButton=d.find("> .close");closeButton.click(function(){e($(this).parent());return false});function e(m){switch(a.animation){case"fade":f(m);break;case"slide":l(m);break;case"box":k(m);break;case"fadeAndSlide":g(m);break;default:g(m)}}function f(m){m.fadeOut(a.speed)}function l(m){m.slideUp(a.speed)}function g(m){m.fadeTo(a.speed,0,function(){l(m)})}function k(m){m.hide(a.speed)}if(a.hideBoxes){}else{if(!a.hideBoxes){d.css({display:"block",visiblity:"visible"})}}})}})();(function(){var e;var d=function(){};var b=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"];var c=b.length;var a=(window.console=window.console||{});while(c--){e=b[c];if(!a[e]){a[e]=d}}}());